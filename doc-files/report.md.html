                  <meta charset="utf-8">
                 **Rays - Report**
                  **Ryan Patton & Youle Chen
                    rjp2@williams.edu
                    yc2@williams.edu**




Implementation Design
============================================


An instance of [RayTracer](MAKE THIS RIGHT) (soon to be renamed) is given an array of surfaces (hopefully this will also change, from which
it constructs a [G3D::TriTree](http://g3d.cs.williams.edu/g3d/G3D10/build/manual/class_g3_d_1_1_embree_tri_tree.html) to be used by the intersection methods.

Our [APP::renderScene](link) is the the highest level of abstraction. We will be looping over each pixel in the image we want to create, and combining the average of multiple rays (sent at slightly different angles) traced through that pixel to determine its radiance. We will do this with an inverted loop structure, doing all similar actions at the same time and storing the results in buffers to allow for the strategy of SIMD batch-processing multithreading. 

For the actual tracing part of our algorithm, we will be using Monte Carlo integration for calculating direct illumination (using probabilities determined by Importance Sampling). Indirect rays will be shosen using [Surfel::Scatter](LINK) to give us optimal convergence.

Code is built upon Ryan's, Eli's, Youle's and Matheus's rays code.


Correctness Tests
=============================================================

![Eye Ray Directions](eye-ray-directions.png width = 300) ![World-Space Hit Positions](positions.png width = 300)
![World-Space Geometric Normals](normals.png width = 300) ![Cornell Box](direct.png width = 300)

![Box w/ Mirror and Glass Balls](1.png width = 300) 

![2 Scattering Events](2.png width = 150) ![3 Scattering Events](3.png width = 150)
![4 Scattering Events](4.png width = 150) ![10 Scattering Events](10.png width = 150)


Performance
===========================================================

Variance with Scattering Depth
-------------------------------------------
![](scattering-depth.png)


Variance with Paths Per Pixel
-------------------------------------------
![](paths-per-pixel.png)



Quality Demonstration Images
===========================================================

![Quality 1](quality.jpg width = 450)



Phenomena Demonstration Images
===========================================================

Will have to pick 4 phenomena later....

![Caustics](door.jpg width = 150) ![Diffuse Interreflection](sponza.jpg width = 150) ![Soft Shadows](car-ao.jpg width = 150) ![Mirror Reflections](chess.jpg width = 150)


Questions
=============================================================

1. 
    _Why does it take four scattering events to produce a caustic? Give a diagram or otherwise explain what those events are._ 
    As the graph suggests, there are exactly 4 rays of light needed in order to travel through all the surfaces of the spheres and hits our eye eventually.
    *******************************************************************
    * how light travels through the sphere:                           *
    *                                                                 *
    *                        |                                        *
    *                        |                                        *
    *                --------v-----------  upper surface              *
    *                         \                                       *
    *                          \                                      *
    *                           \                                     *
    *                            \                                    *
    *                             v                                   *
    *                   ----------|--------    lower surface          *
    *                             |   eye                             *
    *                             |  ^                                *
    *                             | /                                 *
    *                   ----------v---------   floor                  *
    *                                                                 *
    *******************************************************************      

2.
     _Derive an asymptotic bound on the run time of the global illumination renderer from the Rays project, were it to recurse to an arbitrary path depth. _ 
    
    $n$: pixels,
    $d$: maximum path depth,
    $p$: primary rays per pixel,
    $L$: lights in the scene,
    $r$: recursive rays

    The run time is $O(n×p×L×r^d)$,

    For each pixel in the image, we trace p rays, and computed direct illumination from all sources of light L, and the run time so far is $O(n×p×L)$. For each of these events, we trace back r recursive rays, for d depth, which means in total we create $(r^d)$ rays for each event. Therefore the final run time is $O(n×p×L×r^d)$.
   
3.
    _Derive an asymptotic bound on the run time of the path tracer from this project using the same variables from the previous question._ 

   The run time is $O(n×p×d)$. 
   
   The reasoning is basically the same as the previous question, except in this project, we use importance sampling and only pick one "important" light from all the light sources to represent all the light source. We also only have 1 recursive ray for every primary ray per pixel.

4. 
    _Derive an algorithm to sample the numbers from 0 to 100 proportional to their value._ 
    
    Be well
    
5. 
    _In your own words (and with equations and diagrams as needed), present an mathematically rigorous argument that path tracing as presented in this project converges to a true solution to the rendering equation as the path length and number of paths per pixel approach infinity. State any assumptions underlying that argument explicitly._ 

    A wizrd is never late, nor does he have to demonstrate mathematical rigor



Self-Review
=============================================================

Overall, we deserve a solid A++. Positive visualization.

Code style: ___

Workflow (as represented by journal): _____

Report quality: _____

Report depth/correctness: ___



Skills
============================================================
We learned:

    - How to render images using path tracing
    - All of the many maths that went with that
    - How to program in a multi-threading mindset / style
    - How to pair program


Workflow
==========================================================================================================

 Task                     | Description                                                     |Planned Time(h)| Actual Time
 -------------------------|-----------------------------------------------------------------|--------------:|------------:
  Lab Setup (Prep)        | Get files and repos setup, plan workflow                        |     1.50      |  1.5
  Report Draft (Prep)     | Formatted Markdeep document with placeholder text.              |     0.75      |  0.75
  UI Development Draft    | Make GUI appear with all buttons and options                    |     0.25      |     
  Path-Tracing Loop Draft | Iterates over all pixels, post-processes image (not yet though) |     1.00      |  
  PathTracer Draft        | Rewrite method signatures / adding new ones                     |     0.50      |  
  Imp. Sampling Draft     | Write method signature and put dummy code in                    |     0.25      |   
  Path-Tracing Loop MVP   | Turn pseudocode into actual code                                |     1.00      |  
  PathTracer MVP          | Rewrite code to work with shallow tracing                       |     1.00      |  
  Imp. Sampling MVP       | Generate pretty good values                                     |     1.00      |
  Run Initial Tests/Render| Start running tests / rendering required images                 |     0.25      |
  UI Development MVP      | Render button leads to screen / scene / and image changes       |     0.50      |  
  Report MVP              | Probably-correct answers and quick screenshots.                 |     0.25      |   
  Double-Check Spec       | Make 100% certain that meet all of the specs                    |     0.75      | 
  Run Better Tests/Render |  Run better testes with polished codes                          |     0.25      |
  Overall Polish          | 100% correct, and working GUI.                                  |   2.5 - 42    | 
  Report Polish           | Grammar and spelling, content 100% correct                      |     1.50      |  
 [Project Workflow Planning Table.]


<!-- Markdeep: -->
<style class="fallback">body{visibility:hidden;white-space:pre;font-family:monospace;}</style><script src="https://casual-effects.com/markdeep/latest/markdeep.min.js"></script><script>window.alreadyProcessedMarkdeep||(document.body.style.visibility="visible")</script>